<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>单词详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/bootstrap-3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/detail.css">
    <link rel="stylesheet" href="/css/util/searchInput.css">
</head>
<body style="position:relative;">

    <nav class="navbar navbar-default  hidden-xs" style="margin-bottom: 10px;">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/" style="padding: 0;margin: 0;">
                <img src="/img/logo/logo200.svg" alt="" style="height: 100%;">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" >
            <ul class="nav navbar-nav">
                <li><a href="/wordbook/gotoWordbook"><span class="glyphicon glyphicon-list-alt"></span> 词书 </a></li>
                <li><a href="/notebook/gotoNotebook"><span class="glyphicon glyphicon-file"> </span> 生词本</a></li>
                <li><a href="/book/gotoShelf"><span class="glyphicon glyphicon-book"></span> 小说 </a></li>


            </ul>
            <ul class="nav navbar-nav navbar-right">
                <!--                <li><a href="#">欢迎：ahui</a></li>-->
                <!--                <li><a href="#">登录 <span class="glyphicon glyphicon-log-in"></span></a></li>-->
                <!--                <li><a href="#">注册 <span class="glyphicon glyphicon-registration-mark"></span></a></li>-->
                <!--                <li><a href="#">退出登录 <span class="glyphicon glyphicon-log-out"></span></a></li>-->
                <li><a href="/learner/profile">我的 <span class="glyphicon glyphicon-user"></span></a></li>
            </ul>


        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

    <div id="topTab" class="topTab container visible-xs">
        <div class="row">
            <div class="back col-xs-2 col-md-1 col-md-offset-1" style="cursor: pointer">
                <p><span class="glyphicon glyphicon-menu-left"></span></p>
            </div>
            <div class="col-xs-8 col-md-8" style="position:relative;display:flex;justify-content: center;">

                <div style="padding-left: 15px;"><p>单词详情</p></div>

            </div>

        </div>
    </div>
    <div style="height: 60px;" class="visible-xs"></div>

    <!--搜索框-->
    <div class="row searchBox" style="margin: 0">
        <div class=" col-xs-12 col-sm-10 col-sm-offset-1 col-md-10 col-md-offset-1" >
            <div  style="display:flex;justify-content: center;position:relative;;">
                <input id="searchWord"  type="text" placeholder="search word..." class="" >
                <!--提示框-->
                <button id="searchBtn" style="display: inline-block"><img src="/img/search.png" alt="" style="width: 30px;height: 30px;"></button>
                <div id="tips">

                </div>
            </div>
        </div>
    </div>

    <!--单词发音等简略信息框-->
    <div class="wordDetailBox sampleInfo container" style="position:relative;">

        <!--    单词-->
        <div class="row wordName">
            <div class=" col-xs-10">
                <p class="word" style="font-size: 20px;font-weight: 700;"></p>
            </div>
        </div>
        <!--    音标-->
        <div class="row wordPron">
            <div class=" col-md-10 col-xs-10">

                <p>英 [<span id="uk">'kəʊdɪŋ</span>] <span class="glyphicon glyphicon-volume-down pron_uk_volume"></span></p>
                <!--            <audio id="soundUK" class="sound"  src="http://media.shanbay.com/audio/uk/coding.mp3"></audio>-->
                <p>美 [<span id="us">'koʊdɪŋ</span>] <span class="glyphicon glyphicon-volume-down pron_us_volume"></span></p>
                    <!--            <audio id="soundUS" class="sound"  src="http://media.shanbay.com/audio/us/coding.mp3"></audio>-->
            </div>
        </div>
        <!--    分类-->
        <div class="row classification">
            <div class=" col-md-10 col-xs-10">
                <p id="wordTag" style="font-style:italic;font-size: 14px">暂无信息</p>
            </div>
        </div>

        <!--    收藏-->
        <div class="collectWordBox" content="0">
            收藏
        </div>
    </div>
    <!--释义框-->
    <div class="wordDetailBox container" style="padding: 0 10px 10px 10px;">
        <!--    释义-->
        <div class="row wordPara">
            <div class="col-xs-10"><h4 style="font-weight: 700;">单词释义</h4></div>
            <div class="col-xs-12">
                <p class="wordParaP"></p>

                <p class="english_definition"></p>
            </div>
        </div>
        <!--    <div class="row" style="height: 20px;background-color: #fff;"></div>-->

    </div>
    <!--例句框-->
    <div class="container wordDetailBox sentences" >
        <div class="row">
            <div class="col-xs-12">
                <h4 style="font-weight: 700;">双语例句</h4>
            </div>
        </div>
    </div>

    <!--关闭生词本框-->
    <div class="closeNotebookListBox">
        X
    </div>

    <!--生词本列表-->
    <div class="notebookListBox">
        <h4 style="text-align:center;border-bottom: 1px solid rgba(35, 51, 51, 0.21);padding: 5px 0;margin: 5px 0;">请选择要添加的生词本</h4>
        <ul class="notebookListBoxLists">

        </ul>
        <a href="/notebook/gotoNotebook" style="font-size: 16px;display: block;text-align:center;;">去新建生词本....</a>
    </div>

    <!--提示框，提示加入或移除单词信息-->
    <div class="tipBox" >

    </div>

    <audio id="sound" class="sound" style="width: 0;height: 0;"  src=""></audio>

</body>
</html>
<script src="/jq/jquery.min.js"></script>
<script src="/js/scrollbot.min.js"></script>
<script src="/js/searchInput.js"></script>
<script src="/js/collectWord.js"></script>
<script>
    //本页面显示的单词
    let wordName;

    let pron_us;
    let pron_uk;
    let paraphrase;
    //后退
    $(".back").click(function () {
        window.history.back(-1);
    });

    function init(){
        //发音
        $(".pron_us_volume").click(function () {
            let word = $(".wordName .word").html();
            let src = "http://media.shanbay.com/audio/us/"+word+".mp3";
            $("#sound").attr("src",src);
            $("#sound")[0].play();
        });
        //发音
        $(".pron_uk_volume").click(function () {
            let word = $(".wordName .word").html();
            let src = "http://media.shanbay.com/audio/uk/"+word+".mp3";
            $("#sound").attr("src",src);
            $("#sound")[0].play();
        });

        //例句发音
        $(".sentencePron").click(function () {
            let sen = $(this).attr("content");
                let src = "http://dict.youdao.com/dictvoice?audio="+ sen +"&type=2";
            $("#sound").attr("src",src);
            $("#sound")[0].play();
        });


    }

    //查询该单词的详细数据
    $.ajax({
        type: "post",
        async: true,     //异步执行
        contentType: "application/json;charset=UTF-8",
        url: "/wordect/findWordDetailJson/"+getQueryVariable('word'),
        dataType: "json", //json类型
        success: function(result) {
            console.log(result);

            if(result.code === "200"){
                let word = result.data;
                //填入相应数据
                wordName = word.word + "";
                //搜索框自动填充(可能会耗费一些资源)
                $("#searchWord").val(wordName);
                //其他字段填充
                pron_uk = word.pron_uk;
                pron_us = word.pron_us;
                paraphrase = word.translation;
                $(".wordName .word").html(wordName);
                $(".wordPron #us").html(word.pron_us);
                $(".wordPron #uk").html(word.pron_uk);

                //单词收藏处理
                //wordEctDetail.notebook_id不等于0就说明已经收藏过了
                //这里的notebook_id其实是notebook_word表的id,只是借用这个属性
                if(word.notebook_word_id != 0){
                    $(".collectWordBox").html("已收藏")
                        .css({"color":"#fdf1da","background-color":"#f27c7c"})
                        .attr("content", word.notebook_word_id);

                }

                //单词分类处理
                if(word.tag != null){
                    $(".classification #wordTag").html(word.tag);
                }else {
                    $(".classification #wordTag").html("暂无分类");
                }
                //释义处理，因为这个结果返回的释义用\n换行，所以要将其替换为<br>
                $(".wordPara .wordParaP").html(word.translation.replace(/\\n/gi,"<br>"));
                //单词的英语释义
                $(".wordPara .english_definition").html("<br>" + word.definition.replace(/\\n/gi,"<br>"));


                //清空例句
                $(".sentences").html("");

                //如果找不到例句，直接返回
                if( null != word.sentences && "" != word.sentences){

                    //重新写入例句
                    $.each(word.sentences,function (i,item) {
                        //处理一下例句的单双引号问题
                        //因为用的是有道的接口，有道默认将单引号转为%27，将空格转为%20
                        let sentence = item.sentence_en.replace(/'/gi,"%27");
                        $(".sentences").append("<div class=\"row sentence\">\n" +
                            "        <div class=\"col-xs-12 sentence_en\">\n" +
                            "            <p>"+ parseInt(parseInt(i)+1) +". "+ item.sentence_en +
                            "               <span content='"+ sentence +"' class='glyphicon glyphicon-volume-down sentencePron'></span>" +
                            "           </p> " +
                            "        </div>\n" +
                            "\n" +
                            "        <div class=\"col-xs-12 sentence_cn\">\n" +
                            "            <p>" + item.sentence_cn +
                            "                </p>\n" +
                            "        </div>\n" +
                            "    </div>")
                    })
                }
            }
            else if(result.code == 701){
                // 清空所有内容
                $(".wordDetailBox").fadeOut(100);
                //提示
                //提示框
                $(".tipBox").html("找不到该单词!")
                    .show().fadeOut(5000);
            }


            //事件更新
            init();

        },
        error: function(errmsg) {
            console.log("Ajax获取服务器数据出错了！"+ errmsg);
        }

    });


    //获取页面参数
    function getQueryVariable(variable)
    {
        let query = window.location.search.substring(1);
        let vars = query.split("&");
        for (let i=0;i<vars.length;i++) {
            let pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }

</script>
